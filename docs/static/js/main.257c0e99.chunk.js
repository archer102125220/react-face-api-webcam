(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{171:function(e,t,a){e.exports=a.p+"static/media/cute-eye.b7f35bc3.png"},172:function(e,t,a){e.exports=a.p+"static/media/head.03fb4e8a.png"},173:function(e,t,a){e.exports=a.p+"static/media/glasses.c3b82e8e.png"},174:function(e,t,a){e.exports=a.p+"static/media/moustache.49e6cda2.png"},175:function(e,t,a){e.exports=a.p+"static/media/red-eye.bd5761cb.gif"},181:function(e,t,a){e.exports=a(451)},186:function(e,t,a){},190:function(e,t,a){},360:function(e,t){},362:function(e,t){},394:function(e,t){},395:function(e,t){},451:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),i=a(26),r=a.n(i),c=(a(186),a(27)),o=a.n(c),l=a(59),d=a(167),u=a(168),h=a(179),m=a(169),f=a(180),v=(a(190),a(170)),p=a(9),w=a(178),k=a(171),y=a.n(k),x=a(172),E=a.n(x),g=a(173),b=a.n(g),L=a(174),D=a.n(L),F=a(175),C=a.n(F),S=new Image;S.src=y.a;var T=new Image;T.src=E.a;var M=new Image;M.src=b.a;var N=new Image;N.src=D.a;var I,O,B,_=new Image;_.src=C.a;var R=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(m.a)(t).call(this))).state={loading:!0,selectedFaceDetector:"SSD_MOBILENETV1",FaceDetector:{SSD_MOBILENETV1:"SSD_MOBILENETV1",TINY_FACE_DETECTOR:"TINY_FACE_DETECTOR",MTCNN:"MTCNN"},minConfidence:.5,inputSize:512,scoreThreshold:.5,minFaceSize:20,withFaceLandmarks:!1,withBoxes:!0,withLines:!0,forwardTimes:[],time:0,fps:0,colorLandmarks:"#e4e62d",colorShow:!1,selectedMode:{value:"default",label:"\u57fa\u790e\u7e6a\u88fd"},modes:[{value:"default",label:"\u57fa\u790e\u7e6a\u88fd"},{value:"face-index",label:"\u81c9\u90e8\u7d22\u5f15"},{value:"eyes",label:"\u9ede\u72c0\u773c\u775b"},{value:"cute-eyes",label:"\u53ef\u611b\u773c\u775b"},{value:"mousetache",label:"\u5927\u9ed1\u9b0d\u5b50"},{value:"glasses",label:"\u592a\u967d\u773c\u93e1"},{value:"red-eye",label:"\u8840\u8f2a\u773c"},{value:"head",label:"\u5ddd\u666e\u5927\u982d"}]},e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){I=document.getElementById("inputVideo"),O=document.getElementById("overlay"),B=O.getContext("2d"),this.initDevices()}},{key:"initDevices",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.changeFaceDetector(this.state.FaceDetector.TINY_FACE_DETECTOR);case 2:return e.next=4,navigator.mediaDevices.getUserMedia({video:{}});case 4:t=e.sent,I.srcObject=t;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"changeFaceDetector",value:function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isFaceDetectionModelLoaded()){e.next=7;break}return e.next=3,this.getCurrentFaceDetectionNet().load("./weights");case 3:return e.next=5,p.h.faceLandmark68Net.load("./weights");case 5:return e.next=7,p.h.faceRecognitionNet.load("./weights");case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onCleanCanvas",value:function(){B.clearRect(0,0,O.width,O.height)}},{key:"onPlay",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t,a,n,s,i,r=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!I.paused&&!I.ended&&this.isFaceDetectionModelLoaded()){e.next=2;break}return e.abrupt("return",setTimeout(function(){return r.onPlay()}));case 2:if(this.state.loading&&this.setState({loading:!1}),t=this.getFaceDetectorOptions(),a=Date.now(),n=p.d(I,t),!this.state.withFaceLandmarks){e.next=12;break}return e.next=9,n.withFaceLandmarks();case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,n;case 14:e.t0=e.sent;case 15:s=e.t0,this.updateTimeStats(Date.now()-a),i=this.state.withFaceLandmarks?this.drawLandmarks.bind(this):this.drawDetections.bind(this),s&&i(I,O,[s],this.state.withBoxes),this.state.withBoxes||this.state.withFaceLandmarks||this.onCleanCanvas(),setTimeout(function(){return r.onPlay()});case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"drawDetections",value:function(e,t,a){if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3]){var n=this.resizeCanvasAndResults(e,t,a);p.e(t,n)}}},{key:"drawLandmarks",value:function(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];try{var s=this.resizeCanvasAndResults(e,t,a);n&&p.e(t,s.map(function(e){return e.faceDetection}));var i=s[0];switch(this.state.selectedMode.value){case"face-index":this.drawFaceIndex(i);break;case"cute-eyes":this.drawCuteEyes(i);break;case"eyes":this.drawEyes(i);break;case"red-eye":this.drawRedEye(i);break;case"glasses":this.drawGlasses(i);break;case"mousetache":this.drawMoustache(i);break;case"head":this.drawHead(i);break;case"default":default:this.drawDefault(s,t)}}catch(r){}}},{key:"drawDefault",value:function(e,t){var a=e.map(function(e){return e.faceLandmarks}),n={lineWidth:2,drawLines:this.state.withLines,color:this.state.colorLandmarks};p.f(t,a,n)}},{key:"drawFaceIndex",value:function(e){var t=this;e.faceLandmarks.positions.forEach(function(e,a){var n=e.x,s=e.y;B.fillStyle=t.state.colorLandmarks,B.font="9px Changa one",B.fillText(a,n,s)})}},{key:"drawMoustache",value:function(e){try{var t=e.faceLandmarks.positions[36],a=e.faceLandmarks.positions[45],n=.8*Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.x-a.x,2),.5),s=e.faceLandmarks.positions[51],i=s.x,r=s.y;B.drawImage(N,i-n/20*10,r-n/20*10.5,n,n)}catch(c){}}},{key:"drawGlasses",value:function(e){try{var t=e.faceLandmarks.positions[36],a=e.faceLandmarks.positions[45],n=1.2*Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.x-a.x,2),.5),s=e.faceLandmarks.positions[27],i=s.x,r=s.y;B.drawImage(M,i-n/20*10,r-n/20*9,n,n)}catch(c){}}},{key:"drawHead",value:function(e){try{var t=e.faceLandmarks.positions[2],a=e.faceLandmarks.positions[15],n=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.x-a.x,2),.5),s=e.faceLandmarks.positions[29],i=s.x,r=s.y;B.drawImage(T,i-n/20*11,r-n/20*16,n,n*T.height/T.width)}catch(c){}}},{key:"drawEyes",value:function(e){var t=e.faceLandmarks.positions[37],a=e.faceLandmarks.positions[41],n=(t.x+a.x)/2,s=(t.y+a.y)/2;B.fillStyle=this.state.colorLandmarks,B.fillRect(n,s,20,20);var i=e.faceLandmarks.positions[43],r=e.faceLandmarks.positions[47],c=(i.x+r.x)/2,o=(i.y+r.y)/2;B.fillStyle=this.state.colorLandmarks,B.fillRect(c,o,20,20)}},{key:"drawRedEye",value:function(e){var t=e.faceLandmarks.positions[36];e.faceLandmarks.positions[39];B.drawImage(_,t.x-10,t.y-15,50,50);var a=e.faceLandmarks.positions[42],n=e.faceLandmarks.positions[45];B.drawImage(_,a.x-10,n.y-18,50,50)}},{key:"drawCuteEyes",value:function(e){try{var t=e.faceLandmarks.positions[36],a=e.faceLandmarks.positions[45],n=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.x-a.x,2),.5),s=e.faceLandmarks.positions[27],i=s.x,r=s.y;B.drawImage(S,i-n/2,r-n/20*12,n,n)}catch(c){}}},{key:"resizeCanvasAndResults",value:function(e,t,a){var n=e instanceof HTMLVideoElement?p.g(e):e,s=n.width,i=n.height;return t.width=s,t.height=i,a.map(function(e){return e.forSize(s,i)})}},{key:"updateTimeStats",value:function(e){var t=this.state.forwardTimes;this.setState({forwardTimes:[e].concat(t).slice(0,30)});var a=this.state.forwardTimes.reduce(function(e,t){return e+t})/this.state.forwardTimes.length;this.setState({time:Math.round(a),fps:p.i(1e3/a)})}},{key:"isFaceDetectionModelLoaded",value:function(){return!!this.getCurrentFaceDetectionNet().params}},{key:"getCurrentFaceDetectionNet",value:function(){var e=this.state,t=e.selectedFaceDetector,a=e.FaceDetector;switch(t){case a.SSD_MOBILENETV1:return p.h.ssdMobilenetv1;case a.TINY_FACE_DETECTOR:return p.h.tinyFaceDetector;case a.MTCNN:return p.h.mtcnn;default:return null}}},{key:"getFaceDetectorOptions",value:function(){var e=this.state,t=e.selectedFaceDetector,a=e.FaceDetector,n=e.minConfidence,s=e.inputSize,i=e.scoreThreshold,r=e.minFaceSize;return t===a.SSD_MOBILENETV1?new p.b({minConfidence:n}):t===a.TINY_FACE_DETECTOR?new p.c({inputSize:s,scoreThreshold:i}):new p.a({minFaceSize:r})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"App"},s.a.createElement("h1",{className:"title"},"FaceAPI Detection"),s.a.createElement(w.a,{className:"select-modes",value:this.state.selectedMode,onChange:function(t){return e.setState({selectedMode:t})},options:this.state.modes}),s.a.createElement("div",{className:"face"},s.a.createElement("video",{onPlay:this.onPlay.bind(this),id:"inputVideo",autoPlay:!0,muted:!0}),s.a.createElement("canvas",{id:"overlay"}),s.a.createElement("div",{className:"state",style:{display:this.state.loading?"none":"block"}},s.a.createElement("span",null,"Time: ",this.state.time," ms"),s.a.createElement("span",null,"Estimated Fps: ",this.state.fps)),s.a.createElement("div",{className:"control",style:{display:this.state.loading?"none":"block"}},s.a.createElement("div",{className:"item"},s.a.createElement("input",{id:"lbBoxes",type:"checkbox",checked:this.state.withBoxes,onChange:function(t){return e.setState({withBoxes:t.target.checked})}}),s.a.createElement("label",{htmlFor:"lbBoxes"},"\u81c9\u90e8\u5916\u6846")),s.a.createElement("div",{className:"item"},s.a.createElement("input",{id:"lbMarks",type:"checkbox",checked:this.state.withFaceLandmarks,onChange:function(t){return e.setState({withFaceLandmarks:t.target.checked})}}),s.a.createElement("label",{htmlFor:"lbMarks"},"\u81c9\u90e8\u8f2a\u5ed3"),s.a.createElement("div",{className:"color-picker"},s.a.createElement("div",{className:"swatch",onClick:function(){return e.setState({colorShow:!e.state.colorShow})}},s.a.createElement("div",{className:"color",style:{backgroundColor:this.state.colorLandmarks}})),this.state.colorShow?s.a.createElement("div",{className:"popover"},s.a.createElement("div",{className:"cover",onClick:function(){return e.setState({colorShow:!1})}}),s.a.createElement(v.SketchPicker,{color:this.state.colorLandmarks,onChange:function(t){return e.setState({colorLandmarks:t.hex})}})):null)),s.a.createElement("div",{className:"item"},s.a.createElement("input",{id:"lbLines",type:"checkbox",checked:this.state.withLines,onChange:function(t){return e.setState({withLines:t.target.checked})}}),s.a.createElement("label",{htmlFor:"lbLines"},"\u7279\u5fb5\u9023\u7dda")))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[181,2,1]]]);
//# sourceMappingURL=main.257c0e99.chunk.js.map